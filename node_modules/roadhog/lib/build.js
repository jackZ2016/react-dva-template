"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = _default;

var _path = require("path");

var _build = _interopRequireDefault(require("af-webpack/build"));

var _getUserConfig = _interopRequireDefault(require("af-webpack/getUserConfig"));

var _getWebpackConfig = _interopRequireDefault(require("./getWebpackConfig"));

var _getPaths = _interopRequireDefault(require("./getPaths"));

var _registerBabel = _interopRequireDefault(require("./registerBabel"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const debug = require('debug')('roadhog:build');

function _default(opts = {}) {
  const _opts$cwd = opts.cwd,
        cwd = _opts$cwd === void 0 ? process.cwd() : _opts$cwd,
        watch = opts.watch,
        entry = opts.entry;
  const babel = (0, _path.resolve)(__dirname, './babel.js');
  const paths = (0, _getPaths.default)(cwd);
  return new Promise(resolve => {
    // register babel for config files
    (0, _registerBabel.default)(babel, {
      cwd,
      configOnly: true
    }); // get user config

    const _getConfig = (0, _getUserConfig.default)({
      cwd
    }),
          config = _getConfig.config;

    debug(`user config: ${JSON.stringify(config)}`); // get webpack config

    const webpackConfig = (0, _getWebpackConfig.default)({
      cwd,
      config,
      babel,
      paths,
      entry
    });
    (0, _build.default)({
      webpackConfig,
      watch,
      success: resolve
    });
  });
}